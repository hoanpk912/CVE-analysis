version: '3'

services:
  postgresql:
    image: postgres:12.8-alpine
    environment:
      POSTGRES_DB: confdb
      POSTGRES_USER: confdb
      POSTGRES_PASSWORD: confdb
    ports:
      - '5432:5432'
    volumes:
      - 'pgdataconf:/var/lib/postgresql/data'
    networks:
      confnetwork:
        ipv4_address: 10.0.0.4

  confluence-server:
    depends_on:
      - postgresql
    image: atlassian/confluence-server:8.5.3-ubuntu-jdk11
    ports:
      - '8090:8090'
      - '8091:8091'
      - '5005:5005'
    volumes:
      - 'conf-home:/var/atlassian/application-data/confluence'
    environment:
      ATL_JDBC_URL: jdbc:postgresql://10.0.0.4:5432/confdb
      ATL_JDBC_USER: confdb
      ATL_JDBC_PASSWORD: confdb
      ATL_DB_TYPE: postgresql
      ATL_DB_DRIVER: org.postgresql.Driver
      ATL_DB_SCHEMA_NAME: public
      CATALINA_OPTS: "-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"
    networks:
      confnetwork:
        ipv4_address: 10.0.0.5

volumes:
  pgdataconf: {}
  conf-home: {}

networks:
  confnetwork:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.0.0.0/24